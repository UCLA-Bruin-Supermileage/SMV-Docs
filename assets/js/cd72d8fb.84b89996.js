"use strict";(self.webpackChunksmv_docs=self.webpackChunksmv_docs||[]).push([[2565],{8843:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>h,contentTitle:()=>r,default:()=>c,frontMatter:()=>i,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"networking/part-3-ip","title":"The IP Protocol","description":"Ok, if you didn\'t absorb anything from the previous 2 pages, then now is the time to lock in and start remembering. IP is all around us, it is used to view this web page, to send messages, and to do pretty much anything on the internet. All of the lower level protocols like ethernet, and the physical connectors get abstracted and we mainly refer to connectivity using the IP protocol.","source":"@site/docs/networking/part-3-ip.md","sourceDirName":"networking","slug":"/networking/part-3-ip","permalink":"/info/docs/networking/part-3-ip","draft":false,"unlisted":false,"editUrl":"https://github.com/Howard-Z/SMV-Docs/blob/main/docs/networking/part-3-ip.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"The Ethernet Protocol","permalink":"/info/docs/networking/part-2-ethernet"},"next":{"title":"Changing Perspectives","permalink":"/info/docs/networking/part-4-checkpoint"}}');var o=s(4848),a=s(8453);const i={},r="The IP Protocol",h={},d=[{value:"What&#39;s Wrong With MAC?",id:"whats-wrong-with-mac",level:2},{value:"What is an IP Address?",id:"what-is-an-ip-address",level:2},{value:"IANA",id:"iana",level:2},{value:"TCP/IP &amp; Ports",id:"tcpip--ports",level:2},{value:"Subnets",id:"subnets",level:2},{value:"Taking off the Mask",id:"taking-off-the-mask",level:3},{value:"Take this AND This",id:"take-this-and-this",level:4},{value:"Gaslight, Gatekeep, Girlboss (NAT Tables)",id:"gaslight-gatekeep-girlboss-nat-tables",level:2},{value:"Modifying the MAC addresses",id:"modifying-the-mac-addresses",level:3},{value:"Modifying the IP addresses",id:"modifying-the-ip-addresses",level:3},{value:"Modifying the Ports",id:"modifying-the-ports",level:3},{value:"NAT Tabling",id:"nat-tabling",level:3}];function l(e){const t={a:"a",annotation:"annotation",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",math:"math",mn:"mn",mrow:"mrow",msup:"msup",p:"p",pre:"pre",semantics:"semantics",span:"span",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,a.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"the-ip-protocol",children:"The IP Protocol"})}),"\n",(0,o.jsx)(t.p,{children:"Ok, if you didn't absorb anything from the previous 2 pages, then now is the time to lock in and start remembering. IP is all around us, it is used to view this web page, to send messages, and to do pretty much anything on the internet. All of the lower level protocols like ethernet, and the physical connectors get abstracted and we mainly refer to connectivity using the IP protocol."}),"\n",(0,o.jsx)(t.h2,{id:"whats-wrong-with-mac",children:"What's Wrong With MAC?"}),"\n",(0,o.jsx)(t.p,{children:"Well if you didn't read the last page, then the TLDR is that in order to route traffic using MAC addresses and the Ethernet protocol, every switching device on the network must search through a massive table in order to route traffic correctly. Even with modern day search algorithms and data structures, having to search a table for every single MAC is insanely expensive and would introduce an immense amount of latency (lag for you gamers out there)."}),"\n",(0,o.jsx)(t.p,{children:"So what's so special about the IP protocol? Remember that MAC addresses are binded to physical pieces of hardware, and that hardware doesn't have to stay in one place. Take for example your phone, it has a unique MAC address for the wifi card that's in it, but think about all the different places you travel to: school, home, work, restaurants, and so many more. In order for your friend to send you messages every switch on the planet has to be updated with the latest path to get to your phone. I don't even want to know how disastrous that would even be if this implementation were true."}),"\n",(0,o.jsx)(t.p,{children:"Ok so back to the question of why IP. The reason why we use IP addresses is because they have a hierarchical relationship that allows you to narrow down where a node is. Let's dive in"}),"\n",(0,o.jsx)(t.h2,{id:"what-is-an-ip-address",children:"What is an IP Address?"}),"\n",(0,o.jsx)(t.p,{children:"You've probably heard of IP addresses somewhere in your life and you're here reading this page because you want to learn how it all really works."}),"\n",(0,o.jsx)(t.p,{children:"Let's start with the format. An IP address consists of 4 octets separated by a period. A classic example is:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"192.168.1.1\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Unlike MAC addresses we don't usually notate them using hex, but rather with their direct decimal format. Something to notice with IP addresses is that there are only ",(0,o.jsxs)(t.span,{className:"katex",children:[(0,o.jsx)(t.span,{className:"katex-mathml",children:(0,o.jsx)(t.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,o.jsxs)(t.semantics,{children:[(0,o.jsx)(t.mrow,{children:(0,o.jsxs)(t.msup,{children:[(0,o.jsx)(t.mn,{children:"2"}),(0,o.jsx)(t.mn,{children:"32"})]})}),(0,o.jsx)(t.annotation,{encoding:"application/x-tex",children:"2^{32}"})]})})}),(0,o.jsx)(t.span,{className:"katex-html","aria-hidden":"true",children:(0,o.jsxs)(t.span,{className:"base",children:[(0,o.jsx)(t.span,{className:"strut",style:{height:"0.8141em"}}),(0,o.jsxs)(t.span,{className:"mord",children:[(0,o.jsx)(t.span,{className:"mord",children:"2"}),(0,o.jsx)(t.span,{className:"msupsub",children:(0,o.jsx)(t.span,{className:"vlist-t",children:(0,o.jsx)(t.span,{className:"vlist-r",children:(0,o.jsx)(t.span,{className:"vlist",style:{height:"0.8141em"},children:(0,o.jsxs)(t.span,{style:{top:"-3.063em",marginRight:"0.05em"},children:[(0,o.jsx)(t.span,{className:"pstrut",style:{height:"2.7em"}}),(0,o.jsx)(t.span,{className:"sizing reset-size6 size3 mtight",children:(0,o.jsx)(t.span,{className:"mord mtight",children:(0,o.jsx)(t.span,{className:"mord mtight",children:"32"})})})]})})})})})]})]})})]})," which is about 4.2 billion unique addresses available in the world. As of February 2025, there are 8.2 billion people in the world. If everyone owns at least a cellphone, and a laptop, we would need 16.4 billion addresses to cover it all! So how do we solve this problem?"]}),"\n",(0,o.jsx)(t.h2,{id:"iana",children:"IANA"}),"\n",(0,o.jsx)(t.p,{children:"Ok, before we get to the solution we need to talk about IANA. Who decides who get's what IP address? IANA is responsible for partitioning the IP address space (the 4.2 billion addresses) into chunks for people and organizations to use. Internet Service Providers (ISPs) will get an IP address block from IANA and they can assign those addresses to you, the consumer."}),"\n",(0,o.jsx)(t.p,{children:"I'll note right now that in this one paragraph of explanation, I skipped over A LOT of fine grained details about how IP addresses are distributed. I'm also going to abstract away how IP addresses are routed. If you want to learn more I suggest taking CS 118 or any equivalent networking class at a university. That or good ol' Google search."}),"\n",(0,o.jsx)(t.p,{children:"So ISPs can assign the addresses they are give, but we still haven't solved the problem of running out of addresses."}),"\n",(0,o.jsx)(t.h2,{id:"tcpip--ports",children:"TCP/IP & Ports"}),"\n",(0,o.jsx)(t.p,{children:"Imagine you're at your computer and you're listening to music from a streaming service like Tidal. At the same time you might check your email, work on a document, or something else that requires internet connectivity?"}),"\n",(0,o.jsx)(t.p,{children:"You'll often see IP described as TCP/IP, but what is TCP? TCP or the Transmission Control Protocol is wrapped by IP. This means that inside of an IP packet is a TCP packet. (I'm only going to talk about the important properties but,) An IP packet has a source address and a destination address. With respect to the world wide web, it is the location of your computer. Now we need to handle the different applications in your computer, that's where TCP comes in."}),"\n",(0,o.jsx)(t.p,{children:"TCP (again only noting the important features) contains a source port and a destination port. What a port does is direct traffic to a specific application on a computer."}),"\n",(0,o.jsxs)(t.p,{children:["Let's give an example. To visit a site like ",(0,o.jsx)(t.a,{href:"https://www.ucla.edu",children:"www.ucla.edu"}),", UCLA hosts a web server that is operating on port 443. If you take your browser and visit the site, your browser will make a request with a destination port of 443. Why is it port 443? 443 has been designated by IANA as the HTTPS port. It's just one of those things that has to be defined. Imagine if there wasn't a standard port, you would have to spend ages trying to guess the port for every website you want to visit."]}),"\n",(0,o.jsxs)(t.p,{children:["To denote a port at the end of a url or an IP address you just use a ",(0,o.jsx)(t.code,{children:":"}),". It would look something like:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"192.168.1.1:80 <-- port 80\nwww.howard-zhu.com:443 <-- 443\n"})}),"\n",(0,o.jsx)(t.p,{children:"What about the source side? Your computer's operating system handles the port allocation for each program that's running. Usually what happens is that the source port gets randomly assigned from the unreserved pool of ports that are available on your computer. The last number port you can have is 65535 and if you know your powers of 2, this means that ports take up 16 bits of space."}),"\n",(0,o.jsx)(t.h2,{id:"subnets",children:"Subnets"}),"\n",(0,o.jsx)(t.p,{children:"Alright, so you finally pulled the trigger and moved out of the school dorms and into your own apartment. You search the web and find a sh!tty little ISP, we'll call them Spuctrum (absolutely in no way am I referring to the ISP, Spectrum). You go order their top tier internet package and go pick up your new modem and router."}),"\n",(0,o.jsx)(t.p,{children:"Wait, modem and router? Two different things? Yes, a modem is different from a router because they serve two different purposes. A modem is used to get service from your ISP into your home while a router is there to route traffic within your home and throughout the world wide web. We mostly won't talk about the modem since it's only purpose is to provide internet access and doesn't have much to do with routing or much else."}),"\n",(0,o.jsxs)(t.p,{children:["You've set everything up, and you got your computer and phone connected to the internet. If you search on the web ",(0,o.jsx)(t.code,{children:"what's my ip"})," on your phone and your computer, you'll notice that they come up to the same address."]}),"\n",(0,o.jsx)(t.p,{children:"Wait, how is that possible? Ports to the rescue again, but this time we have an added layer."}),"\n",(0,o.jsx)(t.p,{children:"If you open a command line on Windows or MacOS, (if you're on unix of some kind why are you even here?) you can type in the following commands:"}),"\n",(0,o.jsx)(t.p,{children:"Windows:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"ipconfig\n"})}),"\n",(0,o.jsx)(t.p,{children:"You'll get something that looks like this:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"Ethernet adapter Ethernet:\n\n   Connection-specific DNS Suffix  . : seaslab.seas.ucla.edu\n   IPv4 Address. . . . . . . . . . . : 128.97.85.230\n   Subnet Mask . . . . . . . . . . . : 255.255.255.0\n   Default Gateway . . . . . . . . . : 128.97.85.1\n"})}),"\n",(0,o.jsx)(t.p,{children:"MacOS:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"ifconfig\n"})}),"\n",(0,o.jsx)(t.p,{children:"You might get something that looks like this:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"  en0: flags=8863<UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST> mtu 1500\n       ether 64:76:ba:ae:a3:02 \n       inet6 fe80::6676:baff:feae:a302%en0 prefixlen 64 scopeid 0x4 \n       inet 172.30.7.47 netmask 0xffff0000 broadcast 172.30.255.255\n       nd6 options=1<PERFORMNUD>\n       media: autoselect\n       status: active\n"})}),"\n",(0,o.jsxs)(t.p,{children:["In the Windows output, we will focus on the ",(0,o.jsx)(t.code,{children:"IPv4 Address"})," line and the ",(0,o.jsx)(t.code,{children:"inet"})," line in the Mac output. These IP addresses that are listed in the aforementioned lines are ",(0,o.jsx)(t.code,{children:"local area network"})," addresses or ",(0,o.jsx)(t.code,{children:"LAN"}),' addresses. The IP address that you saw from the "what\'s my IP" search would be a ',(0,o.jsx)(t.code,{children:"wide area network"})," address or ",(0,o.jsx)(t.code,{children:"WAN"})," address. How do these all fit together?"]}),"\n",(0,o.jsx)(t.h3,{id:"taking-off-the-mask",children:"Taking off the Mask"}),"\n",(0,o.jsxs)(t.p,{children:["If you notice from the windows output, there's a field called the ",(0,o.jsx)(t.code,{children:"subnet mask"})," and in the MacOS output there's a ",(0,o.jsx)(t.code,{children:"netmask"})," hidden in the ",(0,o.jsx)(t.code,{children:"inet"})," line. What the subnet mask allows us to do is determine, which IP addresses are within a local network."]}),"\n",(0,o.jsx)(t.p,{children:'How local is "local"?'}),"\n",(0,o.jsx)(t.p,{children:"If you remember how the ethernet protocol/ARP protocol works, ethernet packets/frames will be flooded around the network when new computers join so that switches and other computers can build up their ARP table/MAC address table. It's good to keep in mind that your PC's don't speak IP when communicating through physical means like copper wires or wifi. They use the ethernet protocol. This means that they need to know the destination MAC addresses. Well in a local network, MAC address information gets flooded around, in this case the computer would look it up in their table and set the destination MAC appropriately. So your computer will take the destination IP you want to reach and try to look up the associate MAC address."}),"\n",(0,o.jsx)(t.p,{children:"What if we don't know the destination MAC address? The packet still has to have a destination MAC address right?"}),"\n",(0,o.jsx)(t.p,{children:"We'll cover this when we get to DHCP and other routing stuff."}),"\n",(0,o.jsx)(t.p,{children:"For now, back on track to subnets. So if you've ever taken a lower level computer science class where you get to work with actual bits, you'll be familiar with something called a bit mask. If you haven't then I'm going to go over an operation called the bitwise AND operator."}),"\n",(0,o.jsx)(t.h4,{id:"take-this-and-this",children:"Take this AND This"}),"\n",(0,o.jsx)(t.p,{children:"The AND operator is really simple. I'll show this in these tables. In computer science 0 is equal to False and 1 is equal to True."}),"\n",(0,o.jsxs)(t.table,{children:[(0,o.jsx)(t.thead,{children:(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.th,{style:{textAlign:"left"},children:"X"}),(0,o.jsx)(t.th,{style:{textAlign:"center"},children:"Y"}),(0,o.jsx)(t.th,{style:{textAlign:"right"},children:"X & Y"})]})}),(0,o.jsxs)(t.tbody,{children:[(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{style:{textAlign:"left"},children:"0"}),(0,o.jsx)(t.td,{style:{textAlign:"center"},children:"0"}),(0,o.jsx)(t.td,{style:{textAlign:"right"},children:"0"})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{style:{textAlign:"left"},children:"0"}),(0,o.jsx)(t.td,{style:{textAlign:"center"},children:"1"}),(0,o.jsx)(t.td,{style:{textAlign:"right"},children:"0"})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{style:{textAlign:"left"},children:"1"}),(0,o.jsx)(t.td,{style:{textAlign:"center"},children:"0"}),(0,o.jsx)(t.td,{style:{textAlign:"right"},children:"0"})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{style:{textAlign:"left"},children:"1"}),(0,o.jsx)(t.td,{style:{textAlign:"center"},children:"1"}),(0,o.jsx)(t.td,{style:{textAlign:"right"},children:"1"})]})]})]}),"\n",(0,o.jsx)(t.p,{children:"In simple terms, both inputs have to be 1 to output 1, otherwise it's 0."}),"\n",(0,o.jsx)(t.p,{children:"Bitwise AND takes this a step further and applies it to multi-digit binary numbers. Take this example:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"11101001\n&\n00101101\n"})}),"\n",(0,o.jsx)(t.p,{children:"What do you think the output would be?"}),"\n",(0,o.jsx)(t.p,{children:"To do a bitwise AND, all you have to do is go one digit at a time and apply the AND operator. So your output should look like this:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"00101001\n"})}),"\n",(0,o.jsx)(t.p,{children:"Now that we have this covered, let's dive into why we have masks for IPs."}),"\n",(0,o.jsx)(t.p,{children:"You'll notice in the CLI (command line interface) output that the numbers that make up an IP address are different. How do we know which IP addresses are local?"}),"\n",(0,o.jsx)(t.p,{children:"What you do is take the IP and apply the subnet mask to it. Like so:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"IP: 128.97.85.230\nMask: 255.255.255.0\nMasked IP: 128.97.85.0\n"})}),"\n",(0,o.jsx)(t.p,{children:"Ok... so you basically set the last byte to 0. If I expand to binary it might become a little clearer."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"10000000.01100001.01010101.11100110\n&\n11111111.11111111.11111111.00000000\n-----------------------------------\n10000000.01100001.01010101.00000000\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Notice that in the mask there are a lot of ",(0,o.jsx)(t.strong,{children:"consecutive ones"}),". Looking at the mask we can see that the last 8 bits are 0, this means that the first 24 bits are set in stone by the router. So if you keep the first 24 bits as they are, you can set the last 8 bits to whatever you want and it will define a valid address in the local area network (LAN)."]}),"\n",(0,o.jsx)(t.p,{children:"In this particular example, any address in the range of 128.97.85.0 - 128.97.85.255 is a valid LAN address."}),"\n",(0,o.jsx)(t.p,{children:"You can think of the section of the mask where it is all 1 as the subnet ID and the section of all zeros as the ID of the computer."}),"\n",(0,o.jsx)(t.h2,{id:"gaslight-gatekeep-girlboss-nat-tables",children:"Gaslight, Gatekeep, Girlboss (NAT Tables)"}),"\n",(0,o.jsxs)(t.p,{children:["Fun fact, one of Google's DNS server's is located at the IP of ",(0,o.jsx)(t.code,{children:"8.8.8.8"}),", that's nowhere near any of the subnets that I showed earlier so what happens now?"]}),"\n",(0,o.jsxs)(t.p,{children:["If we want to reach that server what we do is first lookup if the IP is in the LAN, obviously it's not (8.8.8 not equal 128.97.85) So what we do is in the ",(0,o.jsx)(t.strong,{children:"IP packet"})," we set the source IP address to what ever our computer has (in this case 128.97.85.230) and the destination address to 8.8.8.8. Then, in order to send it out, we wrap it in an ethernet frame with a source MAC of our computer a destination MAC of our ",(0,o.jsx)(t.strong,{children:"default gateway"}),". This means that our router will see this packet and strip away the ethernet frame and inspect the IP packet within."]}),"\n",(0,o.jsx)(t.p,{children:"Our gateway/router will see that we are trying to go to 8.8.8.8 and then update a few things."}),"\n",(0,o.jsx)(t.h3,{id:"modifying-the-mac-addresses",children:"Modifying the MAC addresses"}),"\n",(0,o.jsxs)(t.p,{children:["When the router receives the ethernet frame, it will rewrite the source ",(0,o.jsx)(t.strong,{children:"and"})," destination MAC addresses. It will set the source to the router's own MAC address and the destination to be the next upstream node (this is where the route picking happens)"]}),"\n",(0,o.jsx)(t.h3,{id:"modifying-the-ip-addresses",children:"Modifying the IP addresses"}),"\n",(0,o.jsx)(t.p,{children:"Remember when I posed the question of how can we have multiple devices appear under the same address? This section and the next will explain how."}),"\n",(0,o.jsx)(t.p,{children:"So our router actually has 2 IP addresses associated with it. The first one is the gateway address that we are familiar with. This is the LAN facing address that the computers in the local network can see and route packets to. The second is the WAN facing address so that it can communicate with the world wide web."}),"\n",(0,o.jsx)(t.p,{children:"So what happens is when it inspects the IP packet, it will rewrite the source IP address to its WAN address and leave the destination address alone."}),"\n",(0,o.jsx)(t.h3,{id:"modifying-the-ports",children:"Modifying the Ports"}),"\n",(0,o.jsxs)(t.p,{children:["To provide further details to this example. Let's say you are making a DNS request to Google's DNS server at 8.8.8.8. The standard port for DNS requests is port 53. So when your computer sends it out, the IP packet will have a destination port of 53 and a source port arbitrarily determined by your OS, let's say ",(0,o.jsx)(t.code,{children:"12345"}),". What the router will do is look at the source port and rewrite it to some other arbitrary port, let's say ",(0,o.jsx)(t.code,{children:"54321"}),". Then it ",(0,o.jsx)(t.strong,{children:"stores"})," a mapping of what it just overwrote. So when Google sends packet back, it will have a destination port of ",(0,o.jsx)(t.code,{children:"54321"})," which the router will then rewrite back to ",(0,o.jsx)(t.code,{children:"12345"})," and then forward it down into the LAN."]}),"\n",(0,o.jsx)(t.h3,{id:"nat-tabling",children:"NAT Tabling"}),"\n",(0,o.jsx)(t.p,{children:"This process of storing the original state and mapping it to the modified state so that it can be translated back and forth uses a NAT table. NAT stands for Network Address Translation. I'm going to reframe this in a later page, but this is how you can have multiple devices under one IP address."}),"\n",(0,o.jsx)(t.p,{children:"If you remember the port topic from earlier, an analogy would be that your router acts as a computer and the devices in the LAN act as individual applications. So it's the same process that your computer does to have multiple network connections, except at a higher level."})]})}function c(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},8453:(e,t,s)=>{s.d(t,{R:()=>i,x:()=>r});var n=s(6540);const o={},a=n.createContext(o);function i(e){const t=n.useContext(a);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),n.createElement(a.Provider,{value:t},e.children)}}}]);